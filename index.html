<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Information Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-col {
            flex: 1;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .required::after {
            content: " *";
            color: var(--danger);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .image-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .image-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px dashed #ddd;
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-preview i {
            font-size: 3rem;
            color: #aaa;
        }
        
        .id-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .id-control input {
            max-width: 80px;
            text-align: center;
        }
        
        .social-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .social-icon {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9rem;
            flex: 1;
            min-width: 200px;
        }
        
        .social-icon i {
            color: var(--primary);
            width: 20px;
        }
        
        .social-icon input {
            flex: 1;
            padding: 8px;
            font-size: 0.9rem;
        }
        
        .download-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .download-btn {
            flex: 1;
            min-width: 150px;
        }
        
        .qr-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        #qrCode {
            border: 1px solid #ddd;
            padding: 10px;
            background-color: white;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .template-download {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .page-nav {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .page-nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .section-nav {
            position: sticky;
            top: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            z-index: 10;
        }
        
        .section-nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .section-nav-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .form-col {
                min-width: 100%;
            }
            
            .download-btn {
                min-width: 100%;
            }
            
            .page-nav {
                display: none;
            }
            
            .social-icon {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-address-book"></i>
                    <h1>Contact Information Manager</h1>
                </div>
                <div class="nav-buttons">
                    <button class="btn btn-primary" id="newContactBtn">
                        <i class="fas fa-plus"></i> New Contact
                    </button>
                    <button class="btn btn-secondary" id="saveContactBtn">
                        <i class="fas fa-save"></i> Save Contact
                    </button>
                </div>
            </div>
        </header>
        
        <div class="section-nav">
            <div class="section-nav-buttons">
                <button class="btn btn-primary section-nav-btn" data-section="upload-section">
                    <i class="fas fa-file-upload"></i> Upload
                </button>
                <button class="btn btn-primary section-nav-btn" data-section="contact-section">
                    <i class="fas fa-user"></i> Personal Info
                </button>
                <button class="btn btn-primary section-nav-btn" data-section="work-section">
                    <i class="fas fa-briefcase"></i> Work Info
                </button>
                <button class="btn btn-primary section-nav-btn" data-section="im-section">
                    <i class="fas fa-comment-dots"></i> Instant Messaging
                </button>
                <button class="btn btn-primary section-nav-btn" data-section="social-section">
                    <i class="fas fa-share-alt"></i> Social Media
                </button>
                <button class="btn btn-primary section-nav-btn" data-section="export-section">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
        
        <div class="card" id="upload-section">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-file-upload"></i> Upload Contact File
                </h2>
            </div>
            <div class="form-group">
                <label for="fileUpload">Upload CSV or Excel File</label>
                <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls">
                <div class="template-download">
                    <span>Download template:</span>
                    <button class="btn btn-primary" id="downloadTemplateBtn">
                        <i class="fas fa-download"></i> CSV Template
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card" id="contact-section">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-user"></i> Contact Information
                </h2>
                <div class="id-control">
                    <button class="btn btn-warning" id="prevContactBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="contactId" placeholder="ID" min="1">
                    <button class="btn btn-warning" id="nextContactBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <div class="image-upload">
                            <div class="image-preview" id="imagePreview">
                                <i class="fas fa-user"></i>
                            </div>
                            <input type="file" id="imageUpload" accept=".jpg,.jpeg,.png" style="display: none;">
                            <button class="btn btn-primary" id="uploadImageBtn">
                                <i class="fas fa-upload"></i> Upload Image
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="firstName" class="required">First Name</label>
                                <input type="text" id="firstName" required>
                            </div>
                            <div class="form-col">
                                <label for="middleName">Middle Name</label>
                                <input type="text" id="middleName">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName">
                            </div>
                            <div class="form-col">
                                <label for="nickName">Nickname</label>
                                <input type="text" id="nickName">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="phoneHome">Phone Home</label>
                                <input type="tel" id="phoneHome">
                            </div>
                            <div class="form-col">
                                <label for="phoneMobile" class="required">Phone Mobile</label>
                                <input type="tel" id="phoneMobile" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="email">Email</label>
                                <input type="email" id="email">
                            </div>
                            <div class="form-col">
                                <label for="dob">Date of Birth (dd-mmm-yyyy)</label>
                                <input type="text" id="dob" placeholder="e.g., 15-Jan-1985">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="street1">Street 1</label>
                        <input type="text" id="street1">
                    </div>
                    <div class="form-col">
                        <label for="street2">Street 2</label>
                        <input type="text" id="street2">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="city">City</label>
                        <input type="text" id="city">
                    </div>
                    <div class="form-col">
                        <label for="zip">ZIP Code</label>
                        <input type="text" id="zip">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="personalCountry">Country</label>
                        <select id="personalCountry">
                            <option value="">Select Country</option>
                            <!-- Countries will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" id="work-section">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-briefcase"></i> Work Information
                </h2>
            </div>
            
            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="company">Company</label>
                        <input type="text" id="company">
                    </div>
                    <div class="form-col">
                        <label for="department">Department</label>
                        <input type="text" id="department">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="designation">Designation</label>
                        <input type="text" id="designation">
                    </div>
                    <div class="form-col">
                        <label for="role">Role</label>
                        <input type="text" id="role">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="phoneWork">Phone Work</label>
                        <input type="tel" id="phoneWork">
                    </div>
                    <div class="form-col">
                        <label for="workEmail">Work Email</label>
                        <input type="email" id="workEmail">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="workStreet1">Work Street 1</label>
                        <input type="text" id="workStreet1">
                    </div>
                    <div class="form-col">
                        <label for="workStreet2">Work Street 2</label>
                        <input type="text" id="workStreet2">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="workCity">Work City</label>
                        <input type="text" id="workCity">
                    </div>
                    <div class="form-col">
                        <label for="workZip">Work ZIP Code</label>
                        <input type="text" id="workZip">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="country">Country</label>
                        <select id="country">
                            <option value="">Select Country</option>
                            <!-- Countries will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="webAddress">Web Address</label>
                        <input type="url" id="webAddress">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" id="im-section">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-comment-dots"></i> Instant Messaging
                </h2>
            </div>
            
            <div class="form-group">
                <div class="social-icons">
                    <div class="social-icon">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                        <input type="text" id="whatsapp" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fas fa-briefcase"></i>
                        <span>WA Business</span>
                        <input type="text" id="waBusiness" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fas fa-comment"></i>
                        <span>Imo</span>
                        <input type="text" id="imo" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-viber"></i>
                        <span>Viber</span>
                        <input type="text" id="viber" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-twitter"></i>
                        <span>Twitter</span>
                        <input type="text" id="twitter" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-facebook-messenger"></i>
                        <span>Messenger</span>
                        <input type="text" id="messenger" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-weixin"></i>
                        <span>WeChat</span>
                        <input type="text" id="wechat" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-telegram"></i>
                        <span>Telegram</span>
                        <input type="text" id="telegram" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fas fa-ghost"></i>
                        <span>Snapchat</span>
                        <input type="text" id="snapchat" placeholder="Username">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" id="social-section">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-share-alt"></i> Social Media
                </h2>
            </div>
            
            <div class="form-group">
                <div class="social-icons">
                    <div class="social-icon">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                        <input type="text" id="facebook" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-linkedin"></i>
                        <span>LinkedIn</span>
                        <input type="text" id="linkedin" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-instagram"></i>
                        <span>Instagram</span>
                        <input type="text" id="instagram" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fab fa-youtube"></i>
                        <span>YouTube</span>
                        <input type="text" id="youtube" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fas fa-code"></i>
                        <span>Fiverr</span>
                        <input type="text" id="fiverr" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fas fa-briefcase"></i>
                        <span>Upwork</span>
                        <input type="text" id="upwork" placeholder="Username">
                    </div>
                    <div class="social-icon">
                        <i class="fas fa-laptop-code"></i>
                        <span>Freelancer</span>
                        <input type="text" id="freelancer" placeholder="Username">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" id="export-section">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-download"></i> Export Contact
                </h2>
            </div>
            
            <div class="form-group">
                <div class="download-options">
                    <button class="btn btn-success download-btn" id="downloadCsvBtn">
                        <i class="fas fa-file-csv"></i> Download CSV
                    </button>
                    <button class="btn btn-primary download-btn" id="downloadVcfBtn">
                        <i class="fas fa-file-contract"></i> Download VCF
                    </button>
                    <button class="btn btn-warning download-btn" id="downloadQrBtn">
                        <i class="fas fa-qrcode"></i> Download QR Code
                    </button>
                </div>
                
                <div class="qr-code-container">
                    <h3>QR Code Preview</h3>
                    <div id="qrCode"></div>
                    <button class="btn btn-primary" id="generateQrBtn">
                        <i class="fas fa-sync-alt"></i> Generate QR Code
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Contact Information Manager &copy; 2023 | All rights reserved</p>
        </footer>
    </div>

    <!-- Page Navigation Buttons -->
    <div class="page-nav">
        <button class="btn btn-primary page-nav-btn" id="pageUpBtn">
            <i class="fas fa-chevron-up"></i>
        </button>
        <button class="btn btn-primary page-nav-btn" id="pageDownBtn">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <script>
        // Country list
        const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", 
            "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", 
            "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", 
            "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", 
            "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", 
            "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt", "El Salvador", 
            "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", 
            "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", 
            "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", 
            "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", 
            "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", 
            "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", 
            "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", 
            "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", 
            "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", 
            "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", 
            "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", 
            "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", 
            "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", 
            "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", 
            "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", 
            "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ];

        // Initialize contacts array and current contact index
        let contacts = [];
        let currentContactIndex = 0;
        let imageBase64 = '';

        // DOM elements
        const fileUpload = document.getElementById('fileUpload');
        const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
        const contactId = document.getElementById('contactId');
        const prevContactBtn = document.getElementById('prevContactBtn');
        const nextContactBtn = document.getElementById('nextContactBtn');
        const uploadImageBtn = document.getElementById('uploadImageBtn');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const newContactBtn = document.getElementById('newContactBtn');
        const saveContactBtn = document.getElementById('saveContactBtn');
        const downloadCsvBtn = document.getElementById('downloadCsvBtn');
        const downloadVcfBtn = document.getElementById('downloadVcfBtn');
        const downloadQrBtn = document.getElementById('downloadQrBtn');
        const generateQrBtn = document.getElementById('generateQrBtn');
        const qrCodeDiv = document.getElementById('qrCode');
        const countrySelect = document.getElementById('country');
        const personalCountrySelect = document.getElementById('personalCountry');
        const pageUpBtn = document.getElementById('pageUpBtn');
        const pageDownBtn = document.getElementById('pageDownBtn');
        const sectionNavBtns = document.querySelectorAll('.section-nav-btn');

        // Populate country dropdowns
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.textContent = country;
            countrySelect.appendChild(option);
            
            const option2 = document.createElement('option');
            option2.value = country;
            option2.textContent = country;
            personalCountrySelect.appendChild(option2);
        });

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize with a sample contact
            contacts.push(createEmptyContact());
            updateForm();
            generateQRCode();
        });

        fileUpload.addEventListener('change', handleFileUpload);
        downloadTemplateBtn.addEventListener('click', downloadTemplate);
        prevContactBtn.addEventListener('click', showPreviousContact);
        nextContactBtn.addEventListener('click', showNextContact);
        uploadImageBtn.addEventListener('click', () => imageUpload.click());
        imageUpload.addEventListener('change', handleImageUpload);
        newContactBtn.addEventListener('click', createNewContact);
        saveContactBtn.addEventListener('click', saveContact);
        downloadCsvBtn.addEventListener('click', downloadCSV);
        downloadVcfBtn.addEventListener('click', downloadVCF);
        downloadQrBtn.addEventListener('click', downloadQRCode);
        generateQrBtn.addEventListener('click', generateQRCode);
        contactId.addEventListener('change', showContactById);
        pageUpBtn.addEventListener('click', scrollUp);
        pageDownBtn.addEventListener('click', scrollDown);

        // Section navigation
        sectionNavBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Form input event listeners to update QR code in real-time
        const formInputs = document.querySelectorAll('input, select');
        formInputs.forEach(input => {
            input.addEventListener('input', generateQRCode);
        });

        // Functions
        function createEmptyContact() {
            return {
                id: contacts.length + 1,
                imageBase64: '',
                firstName: '',
                middleName: '',
                lastName: '',
                nickName: '',
                phoneHome: '',
                phoneMobile: '',
                email: '',
                dob: '',
                street1: '',
                street2: '',
                city: '',
                zip: '',
                personalCountry: '',
                company: '',
                department: '',
                designation: '',
                role: '',
                phoneWork: '',
                workEmail: '',
                workStreet1: '',
                workStreet2: '',
                workCity: '',
                workZip: '',
                country: '',
                webAddress: '',
                whatsapp: '',
                waBusiness: '',
                imo: '',
                viber: '',
                twitter: '',
                messenger: '',
                wechat: '',
                telegram: '',
                snapchat: '',
                facebook: '',
                linkedin: '',
                instagram: '',
                youtube: '',
                fiverr: '',
                upwork: '',
                freelancer: ''
            };
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // Assuming first sheet
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                if (jsonData.length > 0) {
                    contacts = jsonData.map((item, index) => {
                        return {
                            id: index + 1,
                            ...item
                        };
                    });
                    currentContactIndex = 0;
                    updateForm();
                    generateQRCode();
                    alert(`Successfully loaded ${contacts.length} contacts from file.`);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function downloadTemplate() {
            const templateContact = createEmptyContact();
            delete templateContact.id;
            delete templateContact.imageBase64;
            
            const worksheet = XLSX.utils.json_to_sheet([templateContact]);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Contacts");
            XLSX.writeFile(workbook, "contact_template.xlsx");
        }

        function showPreviousContact() {
            if (currentContactIndex > 0) {
                currentContactIndex--;
                updateForm();
                generateQRCode();
            }
        }

        function showNextContact() {
            if (currentContactIndex < contacts.length - 1) {
                currentContactIndex++;
                updateForm();
                generateQRCode();
            }
        }

        function showContactById() {
            const id = parseInt(contactId.value);
            if (id && id > 0 && id <= contacts.length) {
                currentContactIndex = id - 1;
                updateForm();
                generateQRCode();
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                imageBase64 = e.target.result;
                imagePreview.innerHTML = `<img src="${imageBase64}" alt="Preview">`;
                contacts[currentContactIndex].imageBase64 = imageBase64;
                generateQRCode();
            };
            reader.readAsDataURL(file);
        }

        function createNewContact() {
            contacts.push(createEmptyContact());
            currentContactIndex = contacts.length - 1;
            updateForm();
            generateQRCode();
        }

        function saveContact() {
            // Validate required fields
            if (!contacts[currentContactIndex].firstName || !contacts[currentContactIndex].phoneMobile) {
                alert('First Name and Mobile Phone are required fields.');
                return;
            }

            // Update contact with current form values
            updateContactFromForm();
            
            alert('Contact saved successfully!');
        }

        function updateForm() {
            const contact = contacts[currentContactIndex];
            
            // Update ID field
            contactId.value = contact.id;
            
            // Update image
            if (contact.imageBase64) {
                imagePreview.innerHTML = `<img src="${contact.imageBase64}" alt="Preview">`;
                imageBase64 = contact.imageBase64;
            } else {
                imagePreview.innerHTML = '<i class="fas fa-user"></i>';
                imageBase64 = '';
            }
            
            // Update personal information
            document.getElementById('firstName').value = contact.firstName || '';
            document.getElementById('middleName').value = contact.middleName || '';
            document.getElementById('lastName').value = contact.lastName || '';
            document.getElementById('nickName').value = contact.nickName || '';
            document.getElementById('phoneHome').value = contact.phoneHome || '';
            document.getElementById('phoneMobile').value = contact.phoneMobile || '';
            document.getElementById('email').value = contact.email || '';
            document.getElementById('dob').value = contact.dob || '';
            document.getElementById('street1').value = contact.street1 || '';
            document.getElementById('street2').value = contact.street2 || '';
            document.getElementById('city').value = contact.city || '';
            document.getElementById('zip').value = contact.zip || '';
            document.getElementById('personalCountry').value = contact.personalCountry || '';
            
            // Update work information
            document.getElementById('company').value = contact.company || '';
            document.getElementById('department').value = contact.department || '';
            document.getElementById('designation').value = contact.designation || '';
            document.getElementById('role').value = contact.role || '';
            document.getElementById('phoneWork').value = contact.phoneWork || '';
            document.getElementById('workEmail').value = contact.workEmail || '';
            document.getElementById('workStreet1').value = contact.workStreet1 || '';
            document.getElementById('workStreet2').value = contact.workStreet2 || '';
            document.getElementById('workCity').value = contact.workCity || '';
            document.getElementById('workZip').value = contact.workZip || '';
            document.getElementById('country').value = contact.country || '';
            document.getElementById('webAddress').value = contact.webAddress || '';
            
            // Update instant messaging
            document.getElementById('whatsapp').value = contact.whatsapp || '';
            document.getElementById('waBusiness').value = contact.waBusiness || '';
            document.getElementById('imo').value = contact.imo || '';
            document.getElementById('viber').value = contact.viber || '';
            document.getElementById('twitter').value = contact.twitter || '';
            document.getElementById('messenger').value = contact.messenger || '';
            document.getElementById('wechat').value = contact.wechat || '';
            document.getElementById('telegram').value = contact.telegram || '';
            document.getElementById('snapchat').value = contact.snapchat || '';
            
            // Update social media
            document.getElementById('facebook').value = contact.facebook || '';
            document.getElementById('linkedin').value = contact.linkedin || '';
            document.getElementById('instagram').value = contact.instagram || '';
            document.getElementById('youtube').value = contact.youtube || '';
            document.getElementById('fiverr').value = contact.fiverr || '';
            document.getElementById('upwork').value = contact.upwork || '';
            document.getElementById('freelancer').value = contact.freelancer || '';
        }

        function updateContactFromForm() {
            const contact = contacts[currentContactIndex];
            
            // Update personal information
            contact.firstName = document.getElementById('firstName').value;
            contact.middleName = document.getElementById('middleName').value;
            contact.lastName = document.getElementById('lastName').value;
            contact.nickName = document.getElementById('nickName').value;
            contact.phoneHome = document.getElementById('phoneHome').value;
            contact.phoneMobile = document.getElementById('phoneMobile').value;
            contact.email = document.getElementById('email').value;
            contact.dob = document.getElementById('dob').value;
            contact.street1 = document.getElementById('street1').value;
            contact.street2 = document.getElementById('street2').value;
            contact.city = document.getElementById('city').value;
            contact.zip = document.getElementById('zip').value;
            contact.personalCountry = document.getElementById('personalCountry').value;
            
            // Update work information
            contact.company = document.getElementById('company').value;
            contact.department = document.getElementById('department').value;
            contact.designation = document.getElementById('designation').value;
            contact.role = document.getElementById('role').value;
            contact.phoneWork = document.getElementById('phoneWork').value;
            contact.workEmail = document.getElementById('workEmail').value;
            contact.workStreet1 = document.getElementById('workStreet1').value;
            contact.workStreet2 = document.getElementById('workStreet2').value;
            contact.workCity = document.getElementById('workCity').value;
            contact.workZip = document.getElementById('workZip').value;
            contact.country = document.getElementById('country').value;
            contact.webAddress = document.getElementById('webAddress').value;
            
            // Update instant messaging
            contact.whatsapp = document.getElementById('whatsapp').value;
            contact.waBusiness = document.getElementById('waBusiness').value;
            contact.imo = document.getElementById('imo').value;
            contact.viber = document.getElementById('viber').value;
            contact.twitter = document.getElementById('twitter').value;
            contact.messenger = document.getElementById('messenger').value;
            contact.wechat = document.getElementById('wechat').value;
            contact.telegram = document.getElementById('telegram').value;
            contact.snapchat = document.getElementById('snapchat').value;
            
            // Update social media
            contact.facebook = document.getElementById('facebook').value;
            contact.linkedin = document.getElementById('linkedin').value;
            contact.instagram = document.getElementById('instagram').value;
            contact.youtube = document.getElementById('youtube').value;
            contact.fiverr = document.getElementById('fiverr').value;
            contact.upwork = document.getElementById('upwork').value;
            contact.freelancer = document.getElementById('freelancer').value;
            
            // Update image
            contact.imageBase64 = imageBase64;
        }

        function generateQRCode() {
            updateContactFromForm();
            const contact = contacts[currentContactIndex];
            
            // Create vCard content
            let vCard = 'BEGIN:VCARD\nVERSION:3.0\n';
            vCard += `FN:${contact.firstName} ${contact.lastName}\n`;
            if (contact.nickName) vCard += `NICKNAME:${contact.nickName}\n`;
            if (contact.phoneHome) vCard += `TEL;TYPE=HOME,VOICE:${contact.phoneHome}\n`;
            if (contact.phoneMobile) vCard += `TEL;TYPE=CELL,VOICE:${contact.phoneMobile}\n`;
            if (contact.phoneWork) vCard += `TEL;TYPE=WORK,VOICE:${contact.phoneWork}\n`;
            if (contact.email) vCard += `EMAIL;TYPE=HOME:${contact.email}\n`;
            if (contact.workEmail) vCard += `EMAIL;TYPE=WORK:${contact.workEmail}\n`;
            if (contact.dob) vCard += `BDAY:${formatDateForVCard(contact.dob)}\n`;
            
            // Personal Address
            if (contact.street1 || contact.city || contact.zip || contact.personalCountry) {
                vCard += `ADR;TYPE=HOME:;;${contact.street1};${contact.city};;${contact.zip};${contact.personalCountry}\n`;
            }
            
            // Work address
            if (contact.workStreet1 || contact.workCity || contact.workZip || contact.country) {
                vCard += `ADR;TYPE=WORK:;;${contact.workStreet1};${contact.workCity};;${contact.workZip};${contact.country}\n`;
            }
            
            // Organization
            if (contact.company) vCard += `ORG:${contact.company}\n`;
            if (contact.designation) vCard += `TITLE:${contact.designation}\n`;
            if (contact.role) vCard += `ROLE:${contact.role}\n`;
            if (contact.department) vCard += `X-DEPARTMENT:${contact.department}\n`;
            
            // Social media and URLs
            if (contact.webAddress) vCard += `URL:${contact.webAddress}\n`;
            if (contact.facebook) vCard += `X-SOCIALPROFILE;TYPE=facebook:${contact.facebook}\n`;
            if (contact.linkedin) vCard += `X-SOCIALPROFILE;TYPE=linkedin:${contact.linkedin}\n`;
            if (contact.twitter) vCard += `X-SOCIALPROFILE;TYPE=twitter:${contact.twitter}\n`;
            if (contact.instagram) vCard += `X-SOCIALPROFILE;TYPE=instagram:${contact.instagram}\n`;
            if (contact.youtube) vCard += `X-SOCIALPROFILE;TYPE=youtube:${contact.youtube}\n`;
            if (contact.whatsapp) vCard += `X-SOCIALPROFILE;TYPE=whatsapp:${contact.whatsapp}\n`;
            if (contact.telegram) vCard += `X-SOCIALPROFILE;TYPE=telegram:${contact.telegram}\n`;
            if (contact.snapchat) vCard += `X-SOCIALPROFILE;TYPE=snapchat:${contact.snapchat}\n`;
            if (contact.wechat) vCard += `X-SOCIALPROFILE;TYPE=wechat:${contact.wechat}\n`;
            if (contact.viber) vCard += `X-SOCIALPROFILE;TYPE=viber:${contact.viber}\n`;
            if (contact.fiverr) vCard += `X-SOCIALPROFILE;TYPE=fiverr:${contact.fiverr}\n`;
            if (contact.upwork) vCard += `X-SOCIALPROFILE;TYPE=upwork:${contact.upwork}\n`;
            if (contact.freelancer) vCard += `X-SOCIALPROFILE;TYPE=freelancer:${contact.freelancer}\n`;
            
            // Photo
            if (contact.imageBase64) {
                // Extract base64 data without the data URL prefix
                const base64Data = contact.imageBase64.split(',')[1];
                vCard += `PHOTO;ENCODING=B;TYPE=JPEG:${base64Data}\n`;
            }
            
            vCard += 'END:VCARD';
            
            // Generate QR code
            qrCodeDiv.innerHTML = '';
            const qr = qrcode(0, 'M');
            qr.addData(vCard);
            qr.make();
            qrCodeDiv.appendChild(qr.createImgTag(5));
        }

        function formatDateForVCard(dateString) {
            // Convert dd-mmm-yyyy to yyyymmdd
            const months = {
                'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04',
                'May': '05', 'Jun': '06', 'Jul': '07', 'Aug': '08',
                'Sep': '09', 'Oct': '10', 'Nov': '11', 'Dec': '12'
            };
            
            const parts = dateString.split('-');
            if (parts.length === 3) {
                const day = parts[0].padStart(2, '0');
                const month = months[parts[1]];
                const year = parts[2];
                return `${year}${month}${day}`;
            }
            return '';
        }

        function downloadCSV() {
            updateContactFromForm();
            const contact = contacts[currentContactIndex];
            
            // Create CSV content
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Headers
            const headers = Object.keys(contact);
            csvContent += headers.join(",") + "\n";
            
            // Data
            const row = headers.map(header => {
                let value = contact[header] || '';
                // Handle values that might contain commas
                if (value.includes(',')) {
                    value = `"${value}"`;
                }
                return value;
            }).join(",");
            
            csvContent += row;
            
            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            const fileName = `${contact.firstName}_${contact.lastName}_${contact.phoneMobile}.csv`.replace(/\s+/g, '_');
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadVCF() {
            updateContactFromForm();
            const contact = contacts[currentContactIndex];
            
            // Create vCard content
            let vCard = 'BEGIN:VCARD\nVERSION:3.0\n';
            vCard += `FN:${contact.firstName} ${contact.lastName}\n`;
            if (contact.nickName) vCard += `NICKNAME:${contact.nickName}\n`;
            if (contact.phoneHome) vCard += `TEL;TYPE=HOME,VOICE:${contact.phoneHome}\n`;
            if (contact.phoneMobile) vCard += `TEL;TYPE=CELL,VOICE:${contact.phoneMobile}\n`;
            if (contact.phoneWork) vCard += `TEL;TYPE=WORK,VOICE:${contact.phoneWork}\n`;
            if (contact.email) vCard += `EMAIL;TYPE=HOME:${contact.email}\n`;
            if (contact.workEmail) vCard += `EMAIL;TYPE=WORK:${contact.workEmail}\n`;
            if (contact.dob) vCard += `BDAY:${formatDateForVCard(contact.dob)}\n`;
            
            // Personal Address
            if (contact.street1 || contact.city || contact.zip || contact.personalCountry) {
                vCard += `ADR;TYPE=HOME:;;${contact.street1};${contact.city};;${contact.zip};${contact.personalCountry}\n`;
            }
            
            // Work address
            if (contact.workStreet1 || contact.workCity || contact.workZip || contact.country) {
                vCard += `ADR;TYPE=WORK:;;${contact.workStreet1};${contact.workCity};;${contact.workZip};${contact.country}\n`;
            }
            
            // Organization
            if (contact.company) vCard += `ORG:${contact.company}\n`;
            if (contact.designation) vCard += `TITLE:${contact.designation}\n`;
            if (contact.role) vCard += `ROLE:${contact.role}\n`;
            if (contact.department) vCard += `X-DEPARTMENT:${contact.department}\n`;
            
            // Social media and URLs
            if (contact.webAddress) vCard += `URL:${contact.webAddress}\n`;
            if (contact.facebook) vCard += `X-SOCIALPROFILE;TYPE=facebook:${contact.facebook}\n`;
            if (contact.linkedin) vCard += `X-SOCIALPROFILE;TYPE=linkedin:${contact.linkedin}\n`;
            if (contact.twitter) vCard += `X-SOCIALPROFILE;TYPE=twitter:${contact.twitter}\n`;
            if (contact.instagram) vCard += `X-SOCIALPROFILE;TYPE=instagram:${contact.instagram}\n`;
            if (contact.youtube) vCard += `X-SOCIALPROFILE;TYPE=youtube:${contact.youtube}\n`;
            if (contact.whatsapp) vCard += `X-SOCIALPROFILE;TYPE=whatsapp:${contact.whatsapp}\n`;
            if (contact.telegram) vCard += `X-SOCIALPROFILE;TYPE=telegram:${contact.telegram}\n`;
            if (contact.snapchat) vCard += `X-SOCIALPROFILE;TYPE=snapchat:${contact.snapchat}\n`;
            if (contact.wechat) vCard += `X-SOCIALPROFILE;TYPE=wechat:${contact.wechat}\n`;
            if (contact.viber) vCard += `X-SOCIALPROFILE;TYPE=viber:${contact.viber}\n`;
            if (contact.fiverr) vCard += `X-SOCIALPROFILE;TYPE=fiverr:${contact.fiverr}\n`;
            if (contact.upwork) vCard += `X-SOCIALPROFILE;TYPE=upwork:${contact.upwork}\n`;
            if (contact.freelancer) vCard += `X-SOCIALPROFILE;TYPE=freelancer:${contact.freelancer}\n`;
            
            // Photo
            if (contact.imageBase64) {
                // Extract base64 data without the data URL prefix
                const base64Data = contact.imageBase64.split(',')[1];
                vCard += `PHOTO;ENCODING=B;TYPE=JPEG:${base64Data}\n`;
            }
            
            vCard += 'END:VCARD';
            
            // Create download link
            const blob = new Blob([vCard], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            const fileName = `${contact.firstName}_${contact.lastName}_${contact.phoneMobile}.vcf`.replace(/\s+/g, '_');
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function downloadQRCode() {
            const qrImg = qrCodeDiv.querySelector('img');
            if (qrImg) {
                const link = document.createElement("a");
                link.setAttribute("href", qrImg.src);
                const contact = contacts[currentContactIndex];
                const fileName = `${contact.firstName}_${contact.lastName}_${contact.phoneMobile}_qr.png`.replace(/\s+/g, '_');
                link.setAttribute("download", fileName);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert('Please generate a QR code first.');
            }
        }

        function scrollUp() {
            window.scrollBy({ top: -window.innerHeight, behavior: 'smooth' });
        }

        function scrollDown() {
            window.scrollBy({ top: window.innerHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
